<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2015-11-26 Thu 01:02 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title></title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Spinpx" />
<link rel="stylesheet" type="text/css" href="http://spinpx.com/org.css"/>
</head>
<body>
<div id="preamble" class="status">
<div class = "nav">
    <ul>
    <li><a class = "logo" href="/index.html">SPinPx</a><li>
	<li><a href="/posts.html"> Posts </a></li>
	<li><a href="/notes.html"> Notes </a></li>
	<li><a href="/gists.html"> Gists </a></li>
	<li><a href="/about.html"> About </a></li>
    </ul>
</div>
</div>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">Adblock Filter Algorithm</a>
<ul>
<li><a href="#orgheadline2">trivial algorithm</a></li>
<li><a href="#orgheadline3">shortcuts</a></li>
<li><a href="#orgheadline6">modified Boyer-Moore algorithm</a>
<ul>
<li><a href="#orgheadline4">Rabin-Karp algorithm</a></li>
<li><a href="#orgheadline5">modified</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">Adblock Filter Algorithm</h2>
<div class="outline-text-2" id="text-orgheadline1">
<ul class="org-ul">
<li><a href="https://adblockplus.org/blog/investigating-filter-matching-algorithms">https://adblockplus.org/blog/investigating-filter-matching-algorithms</a></li>
<li>F : f filters</li>
<li>S : n length</li>
</ul>
</div>

<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2">trivial algorithm</h3>
<div class="outline-text-3" id="text-orgheadline2">
<ul class="org-ul">
<li>use an <b>for</b> iterate directly</li>
<li>O(n * f)</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3">shortcuts</h3>
<div class="outline-text-3" id="text-orgheadline3">
<ul class="org-ul">
<li>shortcuts C, length m</li>
<li>hash table H</li>
<li>instead of a set of filters we have a set of shortcuts, we only need to test against filters whose shortcuts we find.</li>
<li>an approach: store all the shortcuts in a hash table H, and look up substrings of S with length m in this hash table.</li>
<li>step1: establish hash table, O(f)</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #237fbf; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">initHashTable</span><span style="color: #2f96dc;">(</span>H, C<span style="color: #2f96dc;">)</span>:
  <span style="color: #237fbf; font-weight: bold;">for</span> c <span style="color: #237fbf; font-weight: bold;">in</span> C:
    <span style="color: #7590db;">H</span><span style="color: #2f96dc;">[</span>C<span style="color: #2f96dc;">]</span> = <span style="color: #1f71ab;">filter</span><span style="color: #2f96dc;">(</span>c<span style="color: #2f96dc;">)</span>
</pre>
</div>
<ul class="org-ul">
<li>step2: match, O(n)</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #237fbf; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">getMatchFilter</span><span style="color: #2f96dc;">(</span>S, M, m<span style="color: #2f96dc;">)</span>:
  <span style="color: #237fbf; font-weight: bold;">for</span> i <span style="color: #237fbf; font-weight: bold;">in</span> <span style="color: #1f71ab;">range</span><span style="color: #2f96dc;">(</span><span style="color: #a45bad;">0</span>, n - m - <span style="color: #a45bad;">1</span><span style="color: #2f96dc;">)</span>:
    <span style="color: #7590db;">substr</span> = S<span style="color: #2f96dc;">[</span>i:i+m<span style="color: #2f96dc;">]</span>
    <span style="color: #237fbf; font-weight: bold;">if</span><span style="color: #2f96dc;">(</span>substr <span style="color: #237fbf; font-weight: bold;">in</span> H <span style="color: #237fbf; font-weight: bold;">and</span> H<span style="color: #bc6ec5;">(</span>substr<span style="color: #bc6ec5;">)</span> == S<span style="color: #2f96dc;">)</span>:
      <span style="color: #237fbf; font-weight: bold;">return</span> H<span style="color: #2f96dc;">(</span>substr<span style="color: #2f96dc;">)</span>
</pre>
</div>
<ul class="org-ul">
<li>substring(S[i:i+m]) method is not efficient, so when filters is less, may be 10 or 100, we use trivial method.</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6">modified Boyer-Moore algorithm</h3>
<div class="outline-text-3" id="text-orgheadline6">
</div><div id="outline-container-orgheadline4" class="outline-4">
<h4 id="orgheadline4">Rabin-Karp algorithm</h4>
<div class="outline-text-4" id="text-orgheadline4">
<ul class="org-ul">
<li>O(n)</li>
<li>similar to shortcuts method above but replaces the expensive substring by straightforward integer operations.</li>
<li>but the author said that he implemented this algorithm that is slowed down by : <code>String.charCodeAt()</code> in Javascript is slow as substring</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline5" class="outline-4">
<h4 id="orgheadline5">modified</h4>
<div class="outline-text-4" id="text-orgheadline5">
<ul class="org-ul">
<li>so, we need to focus on reduce their number.</li>
<li>like the <b>Boyer-Moore</b> algorithm</li>
<li>single-pattern search , works on the character level.</li>
<li>instead of building a jump table based on characters we can build a jump table for pattern substrings of length m/2</li>
<li>build hash table</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #237fbf; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">initHashTable</span><span style="color: #2f96dc;">(</span>H, J, C, m<span style="color: #2f96dc;">)</span>:
  <span style="color: #237fbf; font-weight: bold;">for</span> c <span style="color: #237fbf; font-weight: bold;">in</span> C:
    <span style="color: #7590db;">H</span><span style="color: #2f96dc;">[</span>C<span style="color: #2f96dc;">]</span> = <span style="color: #1f71ab;">filter</span><span style="color: #2f96dc;">(</span>c<span style="color: #2f96dc;">)</span>
    <span style="color: #237fbf; font-weight: bold;">for</span> i <span style="color: #237fbf; font-weight: bold;">in</span> <span style="color: #1f71ab;">range</span><span style="color: #2f96dc;">(</span><span style="color: #a45bad;">0</span>, m/<span style="color: #a45bad;">2</span> + <span style="color: #a45bad;">1</span><span style="color: #2f96dc;">)</span>: <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">need plus one</span>
      <span style="color: #7590db;">substr</span> = c<span style="color: #2f96dc;">[</span>i: i + m/<span style="color: #a45bad;">2</span><span style="color: #2f96dc;">]</span>
      <span style="color: #7590db;">jump</span> = m/<span style="color: #a45bad;">2</span> - i
      <span style="color: #237fbf; font-weight: bold;">if</span><span style="color: #2f96dc;">(</span>substr <span style="color: #237fbf; font-weight: bold;">not</span> <span style="color: #237fbf; font-weight: bold;">in</span> J <span style="color: #237fbf; font-weight: bold;">or</span> J<span style="color: #bc6ec5;">[</span>substr<span style="color: #bc6ec5;">]</span> &gt; jump<span style="color: #2f96dc;">)</span>:
        <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">until jump is 0 . if jump is 0 , means that we match the c completely</span>
        <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">if the substr is matched we jump to the its next substr</span>
        <span style="color: #7590db;">J</span><span style="color: #2f96dc;">[</span>substr<span style="color: #2f96dc;">]</span> = jump
</pre>
</div>
<ul class="org-ul">
<li>match : for an S its length is n</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #237fbf; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">getMatchFilter</span><span style="color: #2f96dc;">(</span>S, H, J, m<span style="color: #2f96dc;">)</span>:
  <span style="color: #7590db;">endPtr</span> = m
  <span style="color: #237fbf; font-weight: bold;">while</span> endPtr &lt;= n:
    <span style="color: #7590db;">substr</span> = S<span style="color: #2f96dc;">[</span>endPtr - m/<span style="color: #a45bad;">2</span>: endPtr<span style="color: #2f96dc;">]</span>
    <span style="color: #237fbf; font-weight: bold;">if</span><span style="color: #2f96dc;">(</span>substr <span style="color: #237fbf; font-weight: bold;">in</span> J <span style="color: #237fbf; font-weight: bold;">and</span> J<span style="color: #bc6ec5;">[</span>substr<span style="color: #bc6ec5;">]</span> &gt; <span style="color: #a45bad;">0</span><span style="color: #2f96dc;">)</span>:
      <span style="color: #7590db;">endPtr</span> = endPtr + J<span style="color: #2f96dc;">[</span>substr<span style="color: #2f96dc;">]</span>
    <span style="color: #237fbf; font-weight: bold;">else</span> <span style="color: #237fbf; font-weight: bold;">if</span> <span style="color: #2f96dc;">(</span>substr <span style="color: #237fbf; font-weight: bold;">in</span> J <span style="color: #237fbf; font-weight: bold;">and</span> J<span style="color: #bc6ec5;">[</span>substr<span style="color: #bc6ec5;">]</span> == <span style="color: #a45bad;">0</span><span style="color: #2f96dc;">)</span>:
      <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">match the shortcut!</span>
      <span style="color: #7590db;">substr</span> = S<span style="color: #2f96dc;">[</span>endPtr - m: endPtr<span style="color: #2f96dc;">]</span>
      <span style="color: #237fbf; font-weight: bold;">if</span> <span style="color: #2f96dc;">(</span>substr <span style="color: #237fbf; font-weight: bold;">in</span> H <span style="color: #237fbf; font-weight: bold;">and</span> H<span style="color: #bc6ec5;">[</span>substr<span style="color: #bc6ec5;">]</span> == S<span style="color: #2f96dc;">)</span>:
        <span style="color: #237fbf; font-weight: bold;">return</span> H<span style="color: #2f96dc;">[</span>substr<span style="color: #2f96dc;">]</span>
      <span style="color: #237fbf; font-weight: bold;">else</span>:
        <span style="color: #7590db;">endPrt</span> += <span style="color: #a45bad;">1</span>
    <span style="color: #237fbf; font-weight: bold;">else</span>:
      <span style="color: #7590db;">endPrt</span> = endPrt + m/<span style="color: #a45bad;">2</span> + <span style="color: #a45bad;">1</span>
      <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">why we add (m/2 + 1)?</span>
</pre>
</div>

<ul class="org-ul">
<li>first, we test a substring of length m/2, if our jump table tells there are patterns containing this substring , then we adjust our current position accordingly.</li>
<li>if teh jump table tell us that we don't need to adjust, the substring is potentially <b>the endding of a pattern</b> and we need to test whether it is. 
<ul class="org-ul">
<li>if not, move out current position by 1</li>
</ul></li>
<li>if the substring isn't in the jump table, then wwe can move by (m/2 + 1) characters, because that we know that no pattern contains this particular subsring.</li>

<li>O(n/m), worst-case: O(n)</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p id="update">Last Updated : 2015-11-26 Thu 01:02 , Created by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.3.2)</p>
</div>
</body>
</html>
